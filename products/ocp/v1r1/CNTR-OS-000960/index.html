<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="x-ua-compatible" content="ie=edge"/>
  <title>CNTR-OS-000960 - V1R1 - STIG-A-View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Online STIG viewer"/>
  <meta name="generator" content="STIG-A-View Static - e276930"/>
  <link href="/static/css/style.css" rel="stylesheet" />
  <link href="/favicon.png" rel="shortcut icon" />
</head>
<body>
<nav class="navbar">
  <a class="navbar-brand" href="/">STIG-A-View</a>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a class="nav-link" href="/stigs">STIGs</a></li>
    <li><a class="nav-link" href="/products">Products</a></li>
  </ul>
</nav>
<div class="container">

  <h2>OpenShift must generate audit records when successful/unsuccessful attempts to delete security objects occur.</h2>
  <p>
  <b>STIG ID:</b> CNTR-OS-000960 &nbsp;|&nbsp;
  <b>CCI: </b>CCI-000172&nbsp;|&nbsp;
  <b>SRG: </b><a href="/srgs/SRG-APP-000501-CTR-001265">SRG-APP-000501-CTR-001265</a> |
  <b>Severity: </b>medium
  </p>
  <div class="container-fluid">
   <div class="row">
     <div class="span1">
       <h3>Vulnerability Discussion</h3>
       By generating audit records for security object deletions, OpenShift enables administrators and security teams to track and investigate any unauthorized or suspicious removal of security objects. These records serve as valuable evidence for detecting and responding to potential security incidents.<br /><br />Audit records for unsuccessful attempts to delete security objects help in identifying unauthorized activities or potential attacks. If an unauthorized entity attempts to delete security objects, the audit records can serve as an early warning sign of a security threat. By monitoring and analyzing such records, administrators can detect and mitigate potential security breaches before they escalate.<br /><br />Audit records play a vital role in forensic analysis and investigation. In the event of a security incident or suspected compromise, audit logs for security object deletions provide valuable information for understanding the scope and impact of the incident.<br /><br />Satisfies: SRG-APP-000501-CTR-001265, SRG-APP-000502-CTR-001270
     </div>
     <div class="span1">
       <h3>Check</h3>
       Verify the Red Hat Enterprise Linux CoreOS (RHCOS) is configured to generate audit records when successful/unsuccessful attempts to delete security objects or categories of information occur by executing the following:<br /> <br />for node in $(oc get node -oname); do oc debug $node -- chroot /host /bin/bash -c 'echo -n "$HOSTNAME "; grep  -e "key=access" -e "key=delete" -e "key=unsuccessful-delete"  -e "key=privileged" -e "key=perm_mod" /etc/audit/audit.rules' 2>/dev/null; done<br /><br />Confirm the following rules exist on each node:<br /><br />-a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=unsuccessful-delete<br />-a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=unsuccessful-delete<br />-a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=unsuccessful-delete<br />-a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=unsuccessful-delete<br />-a always,exit -F arch=b32 -S chmod -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S chmod -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S chown -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S chown -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S fchmodat -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S fchmodat -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S fchmod -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S fchmod -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S fchownat -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S fchownat -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S fchown -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S fchown -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S fremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S fremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S fsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S fsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod                                                                                                                                                   <br />-a always,exit -F arch=b32 -S lchown -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S lchown -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S lremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S lremovexattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S lsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S lsetxattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S mount -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S mount -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S removexattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S removexattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S renameat -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b64 -S renameat -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b64 -S renameat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b64 -S renameat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S renameat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S renameat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S rename -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b64 -S rename -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b64 -S rename -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b64 -S rename -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S rename -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S rename -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S rmdir -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b64 -S rmdir -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b32 -S setxattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S setxattr -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S umount2 -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b64 -S umount2 -F auid>=1000 -F auid!=unset -F key=perm_mod<br />-a always,exit -F arch=b32 -S unlinkat -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b64 -S unlinkat -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b64 -S unlinkat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b64 -S unlinkat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S unlinkat -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S unlinkat -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S unlink -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b64 -S unlink -F auid>=1000 -F auid!=unset -F key=delete<br />-a always,exit -F arch=b64 -S unlink -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b64 -S unlink -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S unlink -F exit=-EACCES -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F arch=b32 -S unlink -F exit=-EPERM -F auid>=1000 -F auid!=unset -F key=access<br />-a always,exit -F path=/usr/bin/chage -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/chcon -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/chsh -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/crontab -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/gpasswd -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/newgrp -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/passwd -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/sudoedit -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/sudo -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/su -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/bin/umount -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/libexec/openssh/ssh-keysign -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/libexec/pt_chown -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/sbin/pam_timestamp_check -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/sbin/postdrop -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/sbin/postqueue -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/sbin/semanage -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/sbin/setfiles -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/sbin/setsebool -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/sbin/unix_chkpwd -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -F path=/usr/sbin/userhelper -F auid>=1000 -F auid!=unset -F key=privileged<br /><br />If the above rules are not listed on each node, this is a finding.
     </div>
     <div class="span1">
       <h3>Fix</h3>
       Apply the machine config to generate audit records when security objects or categories are deleted by executing the following:<br /><br />for mcpool in $(oc get mcp -oname | sed "s:.*/::" ); do<br />echo "apiVersion: machineconfiguration.openshift.io/v1<br />kind: MachineConfig<br />metadata:<br />  name: 75-delete-sec-objects-levels-rules-$mcpool<br />  labels:<br />    machineconfiguration.openshift.io/role: $mcpool<br />spec:<br />  config:<br />    ignition:<br />      version: 3.1.0<br />    storage:<br />      files:<br />      - contents:<br />          source: data:,%23%23%20Unsuccessful%20file%20delete%0A-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20unlink%2Cunlinkat%2Crename%2Crenameat%20-F%20exit%3D-EACCES%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dunsuccessful-delete%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20unlink%2Cunlinkat%2Crename%2Crenameat%20-F%20exit%3D-EACCES%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dunsuccessful-delete%0A-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20unlink%2Cunlinkat%2Crename%2Crenameat%20-F%20exit%3D-EPERM%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dunsuccessful-delete%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20unlink%2Cunlinkat%2Crename%2Crenameat%20-F%20exit%3D-EPERM%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dunsuccessful-delete%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/30-ospp-v42-4-delete-failed.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20fsetxattr%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dperm_mod%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20fsetxattr%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dperm_mod%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-fsetxattr_dac_modification.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20lremovexattr%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dperm_mod%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20lremovexattr%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dperm_mod%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-lremovexattr_dac_modification.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20lsetxattr%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dperm_mod%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20lsetxattr%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dperm_mod%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-lsetxattr_dac_modification.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20removexattr%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dperm_mod%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20removexattr%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dperm_mod%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-removexattr_dac_modification.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/chcon%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_chcon_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20rename%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20rename%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-rename-file-deletion-events.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20renameat%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20renameat%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-renameat-file-deletion-events.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20rmdir%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20rmdir%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-rmdir-file-deletion-events.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20unlink%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20unlink%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-unlink-file-deletion-events.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20arch%3Db32%20-S%20unlinkat%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A-a%20always%2Cexit%20-F%20arch%3Db64%20-S%20unlinkat%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Ddelete%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-unlinkat-file-deletion-events.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/chage%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_chage_execution.rules<br />        overwrite: true<br />" ; done | oc apply -f -
     </div>
   </div>
  </div>

</div>
<div class="footer">
  <hr/>
  This website is not created by, run, approved, or endorsed by the U.S. Department of Defense.
  Use at your own risk. This website is created by
  <a href="https://github.com/Mab879/stigaview-static" target="_blank">open-source</a> software.
</div>
</body>
</html>