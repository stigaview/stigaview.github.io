<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="x-ua-compatible" content="ie=edge"/>
  <title>CNTR-OS-000080 - STIG-A-View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Online STIG viewer"/>
  <meta name="generator" content="STIG-A-View Static - 0ce1fa5"/>
  <link href="/static/css/style.css" rel="stylesheet" />
  <link href="/favicon.png" rel="shortcut icon" />
</head>
<body>
<nav class="navbar">
  <a class="navbar-brand" href="/">STIG-A-View</a>
  <ul>
    <li><a class="nav-link" href="/stigs">STIGs</a></li>
    <li><a class="nav-link" href="/products">Products</a></li>
  </ul>
</nav>
<div class="container">

  <h2>Open Shift must automatically audit account removal actions.</h2>
  <p>
  <b>STIG ID:</b> CNTR-OS-000080 &nbsp;|&nbsp;
  <b>CCI: </b>CCI-001405&nbsp;|&nbsp;
  <b>SRG: </b><a href="/srgs/SRG-APP-000029-CTR-000085">SRG-APP-000029-CTR-000085</a> |
  <b>Severity: </b>medium
  </p>
  <div class="container-fluid">
   <div class="row">
     <div class="span1">
       <h3>Vulnerability Discussion</h3>
       When application accounts are removed, user accessibility is affected. Once an attacker establishes access to an application, the attacker often attempts to remove authorized accounts to disrupt services or prevent the implementation of countermeasures. Auditing account removal actions provides logging that can be used for forensic purposes.<br /><br />To address access requirements, many application developers choose to integrate their applications with enterprise-level authentication/access/audit mechanisms meeting or exceeding access control policy requirements. Such integration allows the application developer to off-load those access control functions and focus on core application features and functionality.
     </div>
     <div class="span1">
       <h3>Check</h3>
       Verify the audit rules capture the execution of setuid and setgid binaries by executing the following:<br /> <br />for node in $(oc get node -oname); do oc debug $node -- chroot /host /bin/bash -c 'echo -n "$HOSTNAME "; grep -e key=privileged /etc/audit/audit.rules || echo "not found"' 2>/dev/null; done<br /><br />If "not found" is printed, this is a finding.<br /><br />Confirm the following rules exist on each node:<br /><br />-a always,exit -S all -F path=/usr/libexec/dbus-1/dbus-daemon-launch-helper -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/sbin/grub2-set-bootflag -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/libexec/openssh/ssh-keysign -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/chage -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/fusermount3 -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/fusermount -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/gpasswd -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/mount -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/newgrp -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/passwd -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/pkexec -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/sudo -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/su -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/umount -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/bin/write -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/libexec/sssd/krb5_child -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/libexec/sssd/ldap_child -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/libexec/sssd/proxy_child -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/libexec/sssd/selinux_child -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/libexec/utempter -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/lib/polkit-1/polkit-agent-helper-1 -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/sbin/mount.nfs -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/sbin/pam_timestamp_check -F auid>=1000 -F auid!=unset -F key=privileged<br />-a always,exit -S all -F path=/usr/sbin/unix_chkpwd -F auid>=1000 -F auid!=unset -F key=privileged<br /><br />To find all setuid binaries on the system, execute the following:<br /><br />for node in $(oc get node -oname); do oc debug $node -- chroot /host /bin/bash -c 'echo -n "$HOSTNAME "; find / -xdev -type f -perm -4000 -o -type f -perm -2000 2>/dev/null'; done<br /><br />If any setuid binary does not have a corresponding audit rule, this is a finding.
     </div>
     <div class="span1">
       <h3>Fix</h3>
       Apply the machine config by executing the following:<br /><br />for mcpool in $(oc get mcp -oname | sed "s:.*/::" ); do<br />echo "apiVersion: machineconfiguration.openshift.io/v1<br />kind: MachineConfig<br />metadata:<br />  name: 75-setuid-setgid-binaries-$mcpool<br />  labels:<br />    machineconfiguration.openshift.io/role: $mcpool<br />spec:<br />  config:<br />    ignition:<br />      version: 3.1.0<br />    storage:<br />      files:<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/chage%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_chage_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/fusermount%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_fusermount_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/fusermount3%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_fusermount3_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/gpasswd%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_gpasswd_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/mount%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_mount_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/newgrp%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_newgrp_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/passwd%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_passwd_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/pkexec%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_pkexec_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/su%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_su_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/sudo%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_sudo_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/bin/umount%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_bin_umount_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/lib/polkit-1/polkit-agent-helper-1%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_lib_polkit_helper_execution.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/libexec/dbus-1/dbus-daemon-launch-helper%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-dbus_daemon_launch_helper.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/libexec/sssd/krb5_child%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_libexec_sssd_krb5_child.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/libexec/sssd/ldap_child%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_libexec_sssd_ldap_child.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/libexec/sssd/proxy_child%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_libexec_sssd_proxy_child.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/libexec/sssd/selinux_child%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_libexec_sssd_selinux_child.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/sbin/grub2-set-bootflag%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-grub2_set_bootflag.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/sbin/mount.nfs%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_sbin_mount_nfs.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/sbin/pam_timestamp_check%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_sbin_pam_timestamp_check.rules<br />        overwrite: true<br />      - contents:<br />          source: data:,-a%20always%2Cexit%20-F%20path%3D/usr/sbin/unix_chkpwd%20-F%20auid%3E%3D1000%20-F%20auid%21%3Dunset%20-F%20key%3Dprivileged%0A<br />        mode: 0644<br />        path: /etc/audit/rules.d/75-usr_sbin_unix_chkpwd.rules<br />        overwrite: true<br />" | oc apply -f -<br />done
     </div>
   </div>
  </div>

</div>
<div class="footer">
  <hr/>
  This website is not created by, run, approved, or endorsed by the U.S. Department of Defense.
  Use at your own risk. This website is created by
  <a href="https://github.com/Mab879/stigaview-static" target="_blank">open-source</a> software.
</div>
</body>
</html>